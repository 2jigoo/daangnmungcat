<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="daangnmungcat.mapper.JoongoListMapper">

<sql id="selectSQL">
	SELECT rownum, js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID
</sql>


<sql id="selectDongne1SQL">
	SELECT  d1.id AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME
	FROM DONGNE1 d1 JOIN DONGNE2 d2  ON d1.id = d2.DONGNE1_ID WHERE d1.NAME = #{dongne1} 
</sql>


<sql id="selectDongne2SQL">
	SELECT  d1.id AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME
	FROM DONGNE1 d1 JOIN DONGNE2 d2 ON d1.id = d2.DONGNE1_ID WHERE d1.NAME = #{dongne1} AND d2.NAME = #{dongne2}
</sql>

<resultMap type="Sale" id="saleResult">
	<id column="id" property="id"/>
	<result column="mem_id" property="member.id"/>
	<result column="dog_cate" property="dogCate"/>
	<result column="cat_cate" property="catCate"/>
	<result column="title" property="title"/>
	<result column="content" property="content"/>
	<result column="price" property="price"/>
	<result column="buy_mem_id" property="buyMember.id"/>
	<result column="sale_state" property="saleState"/>
	<result column="regdate" property="regdate"/>
	<result column="redate" property="redate"/>
	<result column="hits" property="hits"/>
	<result column="chat_count" property="chatCount"/>
	<result column="heart_count" property="heartCount"/>
	
	<association property="dongne1" resultMap="dongne1Result"/>
	<association property="dongne2" resultMap="dongne2Result"/>
</resultMap>

<resultMap type="Dongne1" id="dongne1Result">
	<id column="DONGNE1ID" property="id"/>
	<result column="DONGNE1NAME" property="name"/>
</resultMap>

<resultMap type="Dongne2" id="dongne2Result">
	<id column="DONGNE2ID" property="id"/>
	<result column="DONGNE2NAME" property="name"/>
</resultMap>



<select id="selectJoongoByAll" resultMap="saleResult">
	<include refid="selectSQL"/>
</select>


<select id="selectDongne1ByAll" resultMap="saleResult">
	<include refid="selectDongne1SQL"/>
</select>

<select id="selectDongne2ByAll" resultMap="saleResult">
	<include refid="selectDongne2SQL"/>
</select>


<select id="selectJoongoByAllPage" resultMap="saleResult">
SELECT a.*
  FROM (SELECT rownum AS rnum, b.*
  		FROM (SELECT js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT 
  FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID ORDER BY js.id desc) b) a
 WHERE a.rnum BETWEEN #{rowStart} AND #{rowEnd}
 ORDER BY a.rnum
</select>


<select id="selectJoongoByDongne1" parameterType="map" resultMap="saleResult">
SELECT a.*
  FROM (SELECT rownum AS rnum, b.*
  		FROM (SELECT js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT 
  FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID WHERE d1.NAME = #{dongne1} ORDER BY js.id desc) b) a
 WHERE a.rnum BETWEEN #{cri.rowStart} AND #{cri.rowEnd}
 ORDER BY a.rnum
	<!-- <include refid="selectSQL"/>
	WHERE d1.NAME = #{dongne1.name} -->
</select>


<select id="selectJoongoByDongne2" parameterType="map" resultMap="saleResult">
SELECT a.*
  FROM (SELECT rownum AS rnum, b.*
  		FROM (SELECT js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT 
  FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID WHERE d1.NAME = #{dongne1} AND d2.NAME = #{dongne2} ORDER BY js.id desc) b) a
 WHERE a.rnum BETWEEN #{cri.rowStart} AND #{cri.rowEnd}
 ORDER BY a.rnum
	<!-- <include refid="selectSQL"/>
	WHERE d1.NAME = #{dongne1} AND d2.NAME = #{dongne2} -->
</select>



<select id="listCount" parameterType="map" resultType="int">
SELECT count(a.id)
  FROM (SELECT rownum AS rnum, b.*
  		FROM (SELECT js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT 
  FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID 
  ORDER BY js.id desc) b) a
</select>

<select id="listCount1" parameterType="map" resultType="int">
SELECT count(a.id)
  FROM (SELECT rownum AS rnum, b.*
  		FROM (SELECT js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT 
  FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID WHERE d1.NAME = #{dongne1} 
  ORDER BY js.id desc) b) a
</select>

<select id="listCount2" parameterType="map" resultType="int">
SELECT count(a.id)
  FROM (SELECT rownum AS rnum, b.*
  		FROM (SELECT js.ID, MEM_ID, DOG_CATE, CAT_CATE, TITLE, CONTENT, PRICE, d1.ID AS DONGNE1ID, d1.NAME AS DONGNE1NAME, d2.ID AS DONGNE2ID, d2.NAME AS DONGNE2NAME, BUY_MEM_ID, SALE_STATE, REGDATE, REDATE, HITS, CHAT_COUNT, HEART_COUNT 
  FROM JOONGO_SALE js LEFT JOIN DONGNE1 d1 ON js.DONGNE1_ID = d1.ID LEFT JOIN DONGNE2 d2 ON js.DONGNE2_ID = d2.ID WHERE d1.NAME = #{dongne1} and d2.NAME = #{dongne2} 
  ORDER BY js.id desc) b) a
</select>


<insert id="insertJoongoSale">
	INSERT INTO JOONGO_SALE (ID, MEM_ID, DOG_CATE , CAT_CATE , TITLE , CONTENT , PRICE, DONGNE1_ID , DONGNE2_ID , SALE_STATE, REGDATE, HITS, CHAT_COUNT ,HEART_COUNT)
	values(sale_seq.nextval, #{member.id}, #{dogCate}, #{catCate}, #{title}, #{content}, #{price}, #{dongne1.id}, #{dongne2.id},1,sysdate,0,0,0)
</insert>


</mapper>